---
title: "Vignette Title"
author: "Vignette Author"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r dependencies}
library(UpdateAnno) # Get orig btm data
BiocInstaller::biocLite("org.Hs.eq.db", suppressUpdates = TRUE) # Get latest version of official gene symbols
library(org.Hs.eg.db)
library(GSEABase)
library(data.table)
```

Read in original GMT file 
```{r orig-gmt}
# path2gmt <- "/home/ehenrich/R/HIPCGeneModuleAnalysis/data/BTM_for_GSEA_20131008.gmt"
# btm <- getGmt(path2gmt)
# btm_list <- geneIds(btm)
dt_btm <- rbindlist(lapply(orig_btm_list, data.table), idcol = "module") # change to data.table
setnames(dt_btm, "V1", "ALIAS")
```


Update the current GMT list object with latest official ALIAS2SYMBOL mappings
```{r update-gmt}
std <- data.table(select(org.Hs.eg.db, 
                         keys = keys(org.Hs.eg.db, keytype = "SYMBOL"), 
                         columns = c("ALIAS", "SYMBOL"), 
                         keytype = "SYMBOL"))
dt_btm[std, SYMBOL := SYMBOL, on = c(ALIAS = "ALIAS")]
dt2 <- data.frame(pathway = dt_btm$module, SYMBOL = dt_btm$SYMBOL, stringsAsFactors = F)
dt2 <- dt2[ !is.na(dt2$SYMBOL), ]
dt2 <- unique(dt2) # MUST DE-DUPE so that gmt file can be created, checked by GeneSet()
```


Recreate gmt file
```{r remake-gmt-file}
dt2_lol <- plyr::dlply(dt2, 1, function(x){ x$SYMBOL }) # convert to list of lists
newbtm <- lapply(names(dt2_lol), function(x){
  GeneSet(setName = x, geneIds = dt2_lol[[x]])
})
gsc <- GeneSetCollection(newbtm)
path2newgmt <- "./updated_bmt.gmt"
toGmt(gsc, path2newgmt)
```

```{r update-btm-data}
updated_btm_list <- dt2_lol
updated_btm_df <- dt2
devtools::use_data(updated_btm_list, overwrite = TRUE)
devtools::use_data(updated_btm_df, overwrite = TRUE)
```
